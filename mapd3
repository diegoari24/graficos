<!DOCTYPE html>
<html>

<head>
    <title>Mapa 1</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>-->
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <style>
        .leaflet-popup-content {
            width: auto !important;
        }
    </style>
</head>

<svg width="100%" height="50" id="example_map"></svg>

<script>
    //var url = "https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/spain-provinces.geojson";
    var url = "https://raw.githubusercontent.com/diegoari24/graficos/master/map.geojson";
    d3.json(url, function(error, world) {
        if (error) throw error;
        var svg = d3.select("#example_map", "#div_customContent")
            .datum(topojson.feature(world, world.objects.land))
            .attr("d", path);
    })
</script>

<style>
    #map-1 {
        background-color: #FFF;
        float: left;
    }
    
    .province {
        fill: #e6e3d2;
        stroke: #555;
        stroke-width: .5px;
        stroke-dasharray: 3 3;
    }
    
    .province:hover {
        fill: #555;
        stroke: rgb(112, 108, 100);
        stroke-width: 2px;
        stroke-dasharray: none;
    }
    
    .graticule {
        fill: none;
        stroke: #FFF;
        stroke-width: .6px;
        stroke-opacity: 0.5;
    }
    
    div.tooltip {
        position: absolute;
        text-align: center;
        width: 60px;
        height: 28px;
        padding: 2px;
        font: 12px sans-serif;
        background: transparent;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }
</style>
<div id="div_customContent">
    <svg id="map-1" width="1300" height="450"></svg>
    <script>
        var svg = d3.select("#map-1"),

            width = +svg.attr("width"),
            height = +svg.attr("height");



        //TOOLTIP VARIABLE CON SUS PROPIEDADES
        var tooltipDiv = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);


        // Creamos la proyección (ver Proyecciones abajo)
        var projection = d3.geoMercator()
            .scale(2500)
            .center([8, 40])
            .translate([width / 1.7, height / 2]);
        //.translate([350, 200]); // Otros atributos
        //.rotate([122.4194, -37.7749])
        //.clipAngle(180 - 1e-3)
        //.precision(0.1);
        // Creamos el path añadiendo la proyección


        var path = d3.geoPath(projection)
            // Creamos una rejilla que se repita cada 2 grados tanto
            // en direcciones norte-sur como este-oeste
        var graticule = d3.geoGraticule().step([2, 2]);
        // Añadimos la rejilla
        svg.append("path")
            .datum(graticule)
            .attr("class", "graticule")
            .attr("d", path);
        // Obtenemos las provincias de España en formato geojson
        //var url = "https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/spain-provinces.geojson";
        // var obtenerPagina;
        //  var cod_prov;
        var url = "https://raw.githubusercontent.com/diegoari24/graficos/master/map.geojson";
        d3.json(url, function(error, spain) {
            obtenerPagina = spain;
            // console.log(JSON.stringify(obtenerPagina));
            //console.log(obtenerPagina.input_data['cod_prov']);

            if (error) throw error; // Manejamos cualquier posible error

            var data = [];
            var obj = obtenerPagina;
            for (var key in obj) {
                data.push(obj[key])
            }

            console.log((data));
            // console.log(data[1][46].properties.url);

            for (let index = 0; index < data.length; index++) {

                var urls = data[1][index].properties.url;
                console.log(urls);
            }


            var urls2 = data[1][46].properties.url;
            //console.log(urls2);
            //SE AGREGAN ELEMENTOS PARA SER CONSTRUIDOS
            var group = svg.selectAll("g") // Creamos un grupo para cada provincia
                .data(spain.features)

            .enter()
                .append("g")
                .on("mouseover", function(d) {

                    tooltipDiv.transition()
                        .duration(200)
                        .style("opacity", .9);

                    tooltipDiv

                        .style("left", (d3.event.pageX + 200) + "px")
                        .style("top", (d3.event.pageY - 130) + "px")
                })
                .style("cursor", "pointer");


            // Para cada grupo añadimos el path correspondiente
            var areas = group.append("path")
                .attr("d", path)
                .attr("class", "province")
                .on("click", function(d) {
                    var w = window.open(
                        urls2,
                        'Resize Window To See Chart Resizing',
                        'width=840px,height=680px,resizable=1,' +
                        'toolbar=0,menubar=0,scrollbars=0')
                });
        });
    </script>
</div>

</html>
